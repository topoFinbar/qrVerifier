<!doctype html>

<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>A Basic HTML5 Template</title>
  <meta name="description" content="A simple HTML5 Template for new projects.">
  <meta name="author" content="SitePoint">

</head>

<body>
  <!-- your content here... -->

<h3>QR-ID verifier</h3>
<h2 style='color: purple'>
    entrati: <span id='countEntrati'>-</span>
    </h2>
<span>status: <b id="status" style="color:green">ready</b></span>
<br>
<!-- <input class="textbox" id="ID" name="ID" type="text" size="40" maxlength="40" value="" onkeyup="checkValue()" /> -->
<!-- <br> -->
<div id="reader" style="width: 600px;"></div>
<br>
<h1 id="response"></h1>

<script src="https://unpkg.com/html5-qrcode"></script>

  	<script>




//*********************************************** const


const maggiorenni = ['87d04b32-1ac2-5473-8b95-63662cadb76d',
 '66b42aa3-447b-53ec-aa80-fc623d985d7a',
 '7f966c7b-5e73-500a-8527-1aa8af529cce',
 'c86b0f12-a633-58f0-a315-ae9d73196714',
 '0957ed89-f637-51aa-8974-d077e9477dc2',
 'f2ed0e82-4574-5b09-83b2-39a14ac970cc',
 'a55fc14d-d158-5c8f-be99-b5420494496b',
 'dd451bf8-8b06-5127-b96e-286aa3b4c984',
 '2146328a-1fe0-5cf5-881c-c90a104dd2e0',
 'e0824d35-0c22-554a-bbd2-d6f0c12a35a6',
 '649e8f14-033a-5aa0-8860-c8208858a59f',
 '57fdafba-ac26-55e3-b4bc-5e7732031b1e',
 'd7794eac-c0d0-57da-8c90-8049be6413e3',
 '9f2441b2-b47b-50f3-9ee8-a986c2b30ca2',
 'c3c4426e-d434-5580-95dc-2a6d9553628e',
 '877ebd33-1904-52e8-ad51-50691ba20c4a',
 '0e88500c-d8b8-5707-a05d-bede66a9788f',
 'a33a0cfa-4ec8-5a11-b4d0-d8bd51b32d50',
 'cf9725d1-4981-55ca-9e36-a9c8fc80cdc3',
 '9d090abd-da5f-5be9-92ad-6493f8572b58',
 '8fa8c220-c7ff-5da6-ae9e-34190c1646ed',
 '4d196e97-3417-53f7-85ba-ae29c949690b',
 '9138ab43-1124-52e5-adc5-512dde8fecf9',
 '32be9f70-018a-5c93-abb9-aafe90c81254',
 'ba958026-c8c5-5494-b62a-c7d64171010b',
 'fa6c72ad-bc59-5063-ae06-cf4ea3462541',
 'aa0465ed-0690-52ff-85f0-66ec56286725',
 '1c6edccb-8d31-5978-98d6-c1b97dd0c2fb',
 '98bc7ac3-d21d-59bb-b18e-e25bd731ff83',
 '325cfcf3-d971-5acd-b1b6-4f882dfcbed7',
 'd30121e3-8868-5c6b-8d69-943067db7ec9',
 '985a83c4-74ee-519e-ad04-ce8718d401d0',
 'e6df6f60-a7e1-5219-bf9f-5cbfad612396',
 '2fbd40da-7b8a-52f6-b604-25af64f23afb',
 '356e1b35-4de6-5e99-93c5-a648e1e91082',
 'a90c81a2-555c-5617-9c2f-1a6ed3d06ec9',
 '4440d52c-5826-5332-ad28-50472834a443',
 'f388844a-72a4-5e10-a21e-689063cd28b0',
 'd376b76c-ed60-5957-82e6-76b60e9363e4',
 'c179fa9f-de01-526c-850b-f96b768910c3',
 '5edc1324-dee5-5648-b1cc-988e9b171f7f',
 'a64c7dda-52cb-5160-82e8-056c9d44dd11',
 'bb220524-94fb-53ba-b93e-2ff8b8fb8363',
 '05afebe1-6ac4-5b28-9c8e-0b302ba046dd',
 'c50299d7-7142-5b4d-a295-ee95e48585ee',
 'fce48ee7-2963-5419-b433-87ea8b2edaf8',
 '174287aa-5158-5e9e-91cf-f7d4afb47902',
 'f8280a84-af7d-5c7a-bb83-5863ec316354',
 '034e9d1e-f8ba-5813-80cb-7c49a708d5d7',
 'ee0cda12-c1ed-5805-992d-c36296baea37',
 'e6312757-b96f-57d5-a762-984edabbd7a8',
 'a3d15ef1-b081-596e-88b7-a03e8b18c8dd',
 '95bec9c9-63b5-5223-a367-d69b9f7aa026',
 'f71d1ff3-1970-5432-a225-fb02a718dd0e',
 '15e8adf7-f276-5f28-991d-d6011070f462',
 'f503a56d-82e0-5908-8abb-0d54ba78525a',
 'a6fa04d3-d76a-50ba-a976-4025e121faae',
 'af53b2b1-8f58-5d5b-b911-599a17b3fabf',
 'c7aa742e-1d3d-5689-9195-b1b815b43f85',
 '0803aa15-41f8-5ca5-93ac-920dbd65bb6d',
 'f24c249f-53a6-548c-8dfc-f39d3682c109',
 '2eac54fd-d959-58b2-99c3-8cd9842a1ee3',
 '23087568-d34e-53f9-aca9-80e0d44c68c2',
 'b3b5fecc-5304-53ec-b808-c8231313e438',
 '339953b4-9ca4-5a9a-a184-ad7df309bcec',
 '096eaa82-e7cf-518d-af74-7243c62a8aed',
 '209da0ea-dc42-5863-9969-466d00436689',
 '7d6ceae7-a548-505d-b2f8-e92ff5ab8786',
 '72a6239a-57fd-5086-b34d-5152e4145f85',
 '67f15fdd-36eb-5175-b720-34b0d698d9dc',
 'cc3d47d3-fbe9-5c18-826c-cdfd3439312e',
 'f39aee31-41cc-557d-8dcf-68c828cbf77d',
 'b11925e8-f7bb-58ec-b0c5-49835164b7d8',
 '9952a599-4465-526b-9e99-7213950b686f',
 '619a153e-7720-5f82-90d7-9ba5113bd60a',
 'c9e1edcf-cfa3-5d60-87f3-ebb8ed12032a',
 'fbf69c9d-e61e-592b-bd10-9a6cd39926bf',
 '88bd94cf-da1e-563f-bdf6-ba75fae18151',
 '70482039-0dfb-5d78-880b-405af9c86378',
 'e67940d8-23f1-5853-a4be-415f595d20a8',
 'fa68233f-5275-5a59-91dd-896a75adb50a',
 '60094004-3fe9-5b12-bba4-a019416ea155',
 'a560601b-2c5b-5eb9-bcd9-a4d308668b45',
 '8434b801-fb50-5658-b94a-be6abb8833a5',
 '8888015d-31e5-5b63-b06d-3bbbe6ee2c6a',
 'b50e2781-cc7e-545e-b8dd-ad2c7352fa3a',
 'e8957b6a-8b69-5e70-ae31-1e352a6d1476',
 '9de54d2f-b3ec-5d42-8446-6f1fcd91cdb1',
 '485ca36b-b9c6-5e7b-97d1-82d237e65aa6',
 '1de491a6-4f8c-5a66-9753-48be14343e53',
 'ebfa23fb-fbac-5d0e-acf5-f4b393a69d7f',
 '348ba6bb-8dd2-536e-bca0-d16d1ed32bb2',
 '4a826615-00de-5a20-b57d-11ffc226e2f2',
 '9f487cbe-ab34-5b19-b084-9adae0260646',
 '3879647f-6ecc-590d-b930-dfa4fd675015',
 '6c88563d-d5d8-59b7-abee-a37d13732d84',
 '9074d02b-5a8b-5455-b05d-8bde00c03745',
 '4b77be73-671a-566c-8856-96b94070a36b',
 'c6409d8f-c44d-55e7-90cb-cc84718e4538',
 '32d17361-9dc7-5263-b36f-0093899372bc',
 'e7734ad5-ca7f-5ee1-bad2-3b8e6718fbec',
 '0fde6797-308a-5298-84ab-30d23b7b2128',
 '4acdc66d-1d1c-5595-b8b4-2fd86f1a6849',
 '8dd6810d-338c-5d8a-ac5e-d6080a119980',
 'fbed7b7b-45e1-5bad-97ec-a7bcdb6ea7e6',
 'c40dc638-eba1-5226-8add-6a44706ebefc',
 '6054e5b8-d725-5500-a252-34f00d874ca7',
 '5ef486b0-7966-59ce-84d6-b63ae6854199',
 'aec2aaf2-ee9a-5d67-88d7-b18ea17a16ec',
 'baa5dcf0-79c6-5a1e-b5a3-17d04df3d147',
 'b06589f2-52e2-5dc4-b2c3-fbadf82fb446',
 '69a29acf-45b0-56e1-9e6b-474468c33a37',
 'ad13d12e-4521-5e49-9d3a-f1dee92437bf',
 '7eefcd1d-acc4-50af-abe8-5f5e556e6d16',
 '03867582-0e1d-5538-bc4f-d20f639e7dce',
 '994fa531-5158-53e8-9f6d-567b7ee3a5e1',
 'e5f3ad33-dede-53f3-9843-af02adee2fba',
 'c600a164-59c7-531b-a2cb-bbe79085078a',
 '36f29a00-0274-5b6d-b4e9-a1d3f80b34dc',
 '777e8249-8a9f-580c-b913-642b7fecc814',
 'd1c9442e-7ec0-537b-a942-6c5ff37e2c11',
 '9b898eea-f2bd-52e6-b41b-2da3e8b96844',
 '74520cbb-eefc-5272-ab19-44621f6a5b18',
 '75cfe1dc-c6b3-5034-ae48-bfcc119cec95',
 '825291e4-1a7d-56e5-8038-5ace53096f10',
 '80483693-e15d-52de-a8a5-8c8518471a96',
 '2d8ba63e-7846-55ad-8da7-357ce75b423b',
 '80d30a27-6640-5387-9c35-50e489837c3c',
 '9f44d388-c4df-5d29-b10a-3b663f9db251',
 'a8f2fef8-3da7-5e26-82bf-7369a32f0aed',
 '951e41b5-cd3a-5e5b-8e23-82b29acbb8da',
 'fc2361be-aeb1-528e-854c-118888d4b1a3',
 '452a1d33-8a5f-580c-ac60-3e2eb897f8d9',
 'c01a0c74-6657-5d6b-acfa-c77fbee9811a',
 '3653db27-54e4-5f34-bbdc-bf118bc16429',
 '7f4ebe68-9449-50b6-9c9e-659465ab1309',
 '09cf0959-3cc6-5026-ba52-ab168ae1d9c1',
 '2e31f5e8-03bd-57cf-ad36-9374740d0ee9',
 'ae6bb68a-e8cf-5488-a7e7-fa1239119ff4',
 'c34c6474-535d-57ec-9689-a02eb2100850',
 'a1e296ec-193e-5b25-9a3f-db33a512f168',
 '88302546-3929-587d-a84f-a43fed477945',
 '5a610092-270b-5780-939d-973cc4934001',
 '9726c38a-e7ff-51a2-bef1-d319ab4666c4',
 'f1881659-51c7-567e-afec-a3867893803e',
 'ca4e067f-ba03-58b2-9cfc-cf5b4fe9dc3e',
 '1ee44487-9f54-5243-ac3b-24cd48b75446',
 '23fe12c9-f3a3-5902-97e7-760de777f568',
 '09f2f9b8-7cf7-5608-899e-7089af34e203',
 '411756a5-edd1-5911-b37c-1c5db144229e',
 '1d372b2b-c9ef-5b1f-8171-dad1bf39a1b9',
 'dc8d3bcd-10f4-5bdd-9a08-5fb3cd9e42b5',
 '2720131e-6784-5ee9-bf8a-498282c3f60c',
 'ef9c6c01-5eb7-5192-8a97-fbaec4247b06',
 'de21f2e4-7838-5e52-acb8-e22991d333b9',
 '50031825-d85a-5e1f-bcc3-3cb145d9a682',
 'ebc965ca-456a-5cf9-a5ec-15d1f99f6157',
 '9f97ce38-2801-5546-8312-a27a917c0b27',
 '2250a4e1-cd02-56a1-9536-3aca05a0f097',
 '17618621-8586-5cff-bb12-56252c9c16b1',
 'd4beefb4-4407-55bb-a336-077dfca42735',
 'e7ac17ed-26bd-53ce-9f94-4a2c20113c2a',
 '4e4eea8b-45f6-5b69-8e60-9d26f4ed9f76',
 '28d7a277-4288-592d-833d-029e4a9d5dbe',
 'cc278a57-40bf-5eec-95a2-8a79190a454e',
 '8479a798-4ed8-54bd-b3c6-618ec727b143',
 'be00fcac-d648-5bd6-bb3e-b78455c47fa7',
 '63389b83-807b-5bc3-a845-47120d135f14',
 '7ee727a3-28ec-5d96-ae3e-24d37d4431ae',
 '60821054-217a-5ee5-806e-3599bbc1878e',
 '6bf4d0a6-7ce1-514c-b504-98e3511d01bb',
 '7b278675-1e8a-548b-a8a4-fc8956f9f986',
 '6bb44530-287b-5223-b57e-2479387df056',
 '6c4d4bea-bfe0-5f82-906d-ec333d66da93',
 '5a14e252-d4b0-53ac-8e5f-1de997890cb3',
 '8a15017b-025c-5895-b059-63c0098c8841',
 '5f6a7097-8287-5c4a-b1e9-4cc1a4a562cf',
 '3ff086ce-5a1f-52a7-9d08-fb9c3122a5cb',
 'dfc5e6d3-c2df-52a7-96ac-ef58cab28797',
 '40d28d69-61f1-5b12-bb6a-5ae07ce4abf5',
 '74eb2677-b915-561b-9a4d-b23a38a2a54b',
 'd7351849-c7cc-5903-b98b-9897d288c7c8',
 '255404f0-337b-5742-a8e7-886633f5b273',
 '097be91c-3f77-5bc3-b087-8642ad98300f',
 '61b65114-8c8f-588c-9d63-3ca6d0543845',
 'cb81aee4-b1e8-5303-867f-abf9de4c25c2',
 'ade7c4c7-7aec-56ba-b158-45c1eaf49ea4',
 '0b15e3aa-0145-5934-a53a-1598584e2bf5',
 '5ac68ceb-b448-581c-93af-9599aa8226fb',
 'df571e80-0df9-5823-9b6a-0565422acaec',
 '6064224f-f449-56f8-be85-4c2df2eb93c5',
 '55ff15b9-3314-5925-b00b-ac55e4d458f9',
 '34810e9e-79a4-5d71-b41b-6b979a2848f3',
 'e4ef52ca-59df-5a7b-9232-57eeb6e5a772',
 '6f525c18-5072-55ff-8006-598fa20b0024',
 'ab248a0f-3865-52a3-b24e-5dc00ff4406c',
 'd5f7ac52-1742-5999-b407-7bae49d326fd',
 'dae8ab87-1782-5cf1-b0df-cae7b4ce898e',
 '2ec050c4-1b23-5973-b4db-1795ec930dbb',
 '7ac45040-50cb-5a89-931f-f54b52c3436a'];
 
var alreadyScanned = [];  //dove memorizzo gli id giÃ  entrati


//***********************************************










//*********************************************** JSON part

const binID = '6387a1b5a3c728450edbc295'
const APIkey = '$2b$10$0lIjtL1PFHpXsLROKTMsmuUMxBDrH4Qi7eMNCJkr04kv2mUfEGwfu'

let read = new XMLHttpRequest();
let req = new XMLHttpRequest();


//1GET e leggiamo quale elemento dell'array prendere
function leggi() {
	var myArr = [];

  read.onreadystatechange = () => {
    if (read.readyState == XMLHttpRequest.DONE) {
      //console.log(req.responseText);
      myArr = JSON.parse(read.responseText);
      //contatoreJson = myArr.record.minorenni;
      //console.log("ho letto");
      //console.log(myArr)
      
    }
  };
  
  read.open("GET", "https://api.jsonbin.io/v3/b/" + binID + "/latest", false);
  read.setRequestHeader("X-Master-Key", APIkey);
  read.send();
  
  return myArr.record.entrati;
}

//3PUT della get + 1
function scrivi(counterUP) {


  req.onreadystatechange = () => {
    if (req.readyState == XMLHttpRequest.DONE) {
      //console.log("scrivo");
    }
  };


  req.open("PUT", "https://api.jsonbin.io/v3/b/" + binID, false);
  req.setRequestHeader("Content-Type", "application/json");
  req.setRequestHeader("X-Master-Key", APIkey);
  req.send(
  	'{"entrati":' + counterUP + '}'
    );

}

/*counter JSON*/
function countValidId(){
	
  var enterUP = leggi() + 1;
  //console.log(enterUP)
  scrivi(enterUP);
  document.getElementById("countEntrati").innerHTML  = enterUP;


}

//***********************************************








//*********************************************** qr scanner part

const scanner = new Html5QrcodeScanner('reader' , {
        qrbox: {
            width: 250,
            height: 250,
        },
        fps: 20,

    });
scanner.render(success, error);

function success(result){
  //console.log('result: ' + result);
  checkValue(result);
  //scanner.clear();
}


function error(err){
    //console.error(err);
    //alert('errore QR scanner, ricarica la pagina :('); //se lo fai, si blocca la pagina
}


//***********************************************








//*********************************************** tools


/*memorizza id scannerizzato*/
function store(id){
  //console.log("ho memorizzato: ");
  //console.log(id);
  alreadyScanned.push(id);
  sleep(2000);
  //clearInputID()
}

/*tempo per memorizzare*/
function sleep(milliseconds) {
  const date = Date.now();
  let currentDate = null;
  do {
    currentDate = Date.now();
  } while (currentDate - date < milliseconds);
}


function claerResponse() {
		//change response
    document.getElementById("response").innerHTML  = ''
    //change status
    document.getElementById("status").innerHTML = "ready"
    document.getElementById("status").style.color = "green"
}


function loadingStatus(){
    //change status
    document.getElementById("status").style.color = "orange"
    document.getElementById("status").innerHTML  = 'loading...'
}


//***********************************************








//*********************************************** varifier


/*operazioni di verifica*/
function checkValue(ID){
  //console.log('validando: ' +ID)
  if(ID == ''){
  	//niente
  }else if (alreadyScanned.includes(ID) && document.getElementById("response").innerHTML != 'entra'){ //questa seconda condizione evita il fast scan
    //console.log('giÃ  scannerizzato')
    //change response
    document.getElementById("response").style.color = "red"
    document.getElementById("response").innerHTML  = 'giÃ  scannerizzato'
    setTimeout(claerResponse, 2500)
  }else if (maggiorenni.includes(ID) ||  minorenni.includes(ID)){
    //console.log('entra')
    //change response
    document.getElementById("response").style.color = "green"
    document.getElementById("response").innerHTML  = 'entra'
	  loadingStatus()
    store(ID)
    //
    countValidId();
    //
    setTimeout(claerResponse, 2500)
  }else if(premium.includes(ID)){
    //console.log('entra: premium')
    //change response
    document.getElementById("response").style.color = "#FFC725"
    document.getElementById("response").innerHTML  = 'entra: premium'
    loadingStatus()
    store(ID)
    setTimeout(claerResponse, 2500)
  }else{
    //console.log('non valido')
    //console.log(ID)
    document.getElementById("response").style.color = "red"
    document.getElementById("response").innerHTML  = 'non valido, riscannerizza'
    setTimeout(claerResponse, 2500)
  }

}


//***********************************************






	</script>
</body>
</html>
